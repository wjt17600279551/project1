<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="shortcut icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><meta name="viewport" content="initial-scale=1,width=device-width,maximum-scale=1,user-scalable=no"/><link rel="manifest" href="/manifest.json"/><link href="http://localhost:9000/bigemap.js/v2.1.0/bigemap.css" rel="stylesheet"/><script src="http://localhost:9000/bigemap.js/v2.1.0/bigemap.js"></script><link href="https://cdn.bootcss.com/Buttons/2.0.0/css/buttons.min.css" rel="stylesheet"><link rel="stylesheet" href="./mouse_draw/Bigemap.draw.css"/><title>React App</title><style>.popup{position:absolute;width:320px;height:371px;left:50%;top:50%;margin-left:-160px;margin-top:-185px;background:linear-gradient(0deg,rgba(7,32,59,1),rgba(0,125,202,1));z-index:99;display:none}.popup .popclose{position:absolute;top:5px;right:5px;font-size:18px;display:block;width:30px;height:30px;text-align:center;line-height:30px}.popup ul{width:100%;margin-top:47px}.popup ul li{margin-left:32px;margin-top:20px;font-size:18px;font-family:DFPYuanW7;font-weight:400;color:rgba(49,213,248,1)}.popup .call{width:35px;height:35px;position:absolute;left:53px;bottom:48px}.popup .mes{width:37px;height:36px;position:absolute;left:138px;bottom:47px}.popup .vid2{width:34px;height:34px;position:absolute;left:139px;bottom:49px}.popup .vid{width:44px;height:26px;position:absolute;left:224px;bottom:53px}</style><link href="/static/css/main.6310255e.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={1:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,"a",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script src="/static/js/2.7d4ee2bd.chunk.js"></script><script src="/static/js/main.f221a277.chunk.js"></script></body><script src="./mouse_draw/Bigemap.draw.js"></script><script src="./mouse_draw/Bigemap.Draw.Event.js"></script><script src="./mouse_draw/draw/handler/Draw.Feature.js"></script><script src="./mouse_draw/draw/handler/Draw.Polyline.js"></script><script src="./mouse_draw/draw/handler/Draw.Polygon.js"></script><script src="./mouse_draw/draw/handler/Draw.SimpleShape.js"></script><script src="./mouse_draw/draw/handler/Draw.Rectangle.js"></script><script src="./mouse_draw/draw/handler/Draw.Circle.js"></script><script src="./mouse_draw/draw/handler/Draw.Marker.js"></script><script src="./mouse_draw/draw/handler/Draw.CircleMarker.js"></script><script src=".mouse_draw/edit/handler/Edit.Poly.js"></script><script src=".mouse_draw/edit/handler/Edit.SimpleShape.js"></script><script src=".mouse_draw/edit/handler/Edit.Rectangle.js"></script><script src=".mouse_draw/edit/handler/Edit.Marker.js"></script><script src=".mouse_draw/edit/handler/Edit.CircleMarker.js"></script><script src=".mouse_draw/edit/handler/Edit.Circle.js"></script><script src="./mouse_draw/ext/TouchEvents.js"></script><script src="./mouse_draw/ext/LatLngUtil.js"></script><script src="./mouse_draw/ext/GeometryUtil.js"></script><script src="./mouse_draw/ext/LineUtil.Intersect.js"></script><script src="./mouse_draw/ext/Polyline.Intersect.js"></script><script src="./mouse_draw/ext/Polygon.Intersect.js"></script><script src="./mouse_draw/Control.Draw.js"></script><script src="./mouse_draw/Tooltip.js"></script><script src="./mouse_draw/Toolbar.js"></script><script src="./mouse_draw/draw/DrawToolbar.js"></script><script src="./mouse_draw/edit/EditToolbar.js"></script><script src="./mouse_draw/edit/handler/EditToolbar.Edit.js"></script><script src="./mouse_draw/edit/handler/EditToolbar.Delete.js"></script><script src="./banner.js"></script><script>BM.Config.HTTP_URL = 'http://localhost:9000';
      
  let map = BM.map('map', 'bigemap.8af4bjs4', { center: [39.90355880302419, 116.39554595927622], zoom: 16, zoomControl: false });
  let nameflag=false,carflag=true,toolflag;
  
  map.on('click',function (e) { 
     console.log('lat: ' + e.latlng.lat + ',lng: ' + e.latlng.lng);
   })

   var drawnItems = new BM.FeatureGroup();
    //添加在地图上

    map.addLayer(drawnItems);

    //设置一个变量来保存当前的绘制对象

    var draw,polygon,circle,square;

    let layers = {};

  map.on(BM.Draw.Event.CREATED, function (e) {
        var layer = e.layer,type = e.layerType;
        console.log(type);
        console.log(layer);
        layer.on('contextmenu',function (e) { 
          this.remove()
         })
        drawnItems.addLayer(layer);
    });

    document.querySelector('#start').onclick= () => {
        if (!draw){
            draw=new BM.Draw.Polygon(map,{repeatMode: true});
        }
        draw.enable();
    }
    
    document.querySelector('#circle').onclick = () =>{
     if(!circle){
       circle = new BM.Draw.Circle(map,{repeatMode: true});
     }
     circle.enable()
    }

    document.querySelector('#square').onclick = () => {
      if(!square){
        square = new BM.Draw.Rectangle(map, {repeatMode: true})
      }
      square.enable()
    }
    document.querySelector('#mapsmall').onclick = () =>{
      map.zoomOut()
    }

    document.querySelector('#mapbig').onclick = () =>{
      map.zoomIn()
    }



    let carmarker = [];

  
    let carlist = window.sessionStorage.getItem('carlist');

    JSON.parse(carlist).carlist.map((v,i) => {
      var myIcon = BM.icon({
      iconUrl: './img/common_icon_gongzuocheliang.png',
      iconSize: [56, 44],
      iconAnchor: [32, 70],
      popupAnchor: [-3, -76],
      shadowSize: [0, 0],
      tooltipAnchor:[24,-50],
      shadowAnchor: [22, 94],
      className:v.number+' carpng'
          });

      let icons = BM.marker([v.lat,v.lng], {icon: myIcon}).addTo(map);
      icons.bindTooltip(v.driver);
      carmarker.push(icons);

    });

    document.querySelector('#getcar').onclick = () => {
    if(carflag){
    carmarker.map((v,i) => {
      v.remove();
      carflag = false;
    })
    }else{
          JSON.parse(carlist).carlist.map((v,i) => {
          var myIcon = BM.icon({
          iconUrl: './img/common_icon_gongzuocheliang.png',
          iconSize: [56, 44],
          iconAnchor: [32, 70],
          popupAnchor: [-3, -76],
          shadowSize: [0, 0],
          shadowAnchor: [22, 94],
          tooltipAnchor:[24,-50],
          className:v.number+' carpng'
              });

         let icons = BM.marker([v.lat,v.lng], {icon: myIcon}).addTo(map);
      icons.bindTooltip(v.driver);
      carmarker.push(icons);

        });
        carflag = true;
        gcarr();
       }
    }
    gcarr();
   function gcarr() { 
    carmarker.map((v,i) => {
      v.on('click',function (e) {
        let classlist = e.target._icon.classList[0];
        map.panTo(BM.latLng(e.latlng.lat,e.latlng.lng), {animate: true, duration: 0.5});
        JSON.parse(carlist).carlist.map((val,ind) => {
          if(val.lat == e.latlng.lat && val.lng == e.latlng.lng){
            console.log(val);
           document.querySelector('.popup').innerHTML = ` 
           <span class="popclose">x</span>  
                 <ul>
                     <li>车辆编号:${val.number}</li>
                     <li>定位:${"???"}</li>
                     <li>驾驶员:${val.driver}</li>
                     <li>单位:${val.unit}</li>
                     <li>电话:${val.phone}</li>
                 </ul>
          
                 <img class="call" title="拨号" src="./img/tankuang_btn_01.png"></img>
                 <img class="vid"  title="设备视频"  src="./img/tankuang_btn_03.png"></img>
                 <img class="vid2" title="发起视频"  src="./img/tankuang_btn_04.png"></img>`;
                 document.querySelector('.popup').style.display = "block";
                 pupclose()
          }
        });
       })
    });
    };

   function pupclose() {
    document.querySelector('.popclose').onclick =  () => {
     document.querySelector('.popup').style.display = "none";
    }
     }

     document.querySelector('.pic').onclick = () => {
       let val = document.querySelector('.searchinput').value;
       JSON.parse(carlist).carlist.map((v,i) => {
         for( key in v){
           if(val == v[key]){
            map.panTo(BM.latLng(v.lat,v.lng), {animate: true, duration: 0.5});
           }
         }
       })
     }</script></html>